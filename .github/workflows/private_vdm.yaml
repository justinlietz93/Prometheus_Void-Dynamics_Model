name: Proofs

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Configure GitHub PAT for private dependency
        env:
          GH_PAT: ${{ secrets.PRIVATE_REPO_TOKEN }}
        run: |
          printf "machine github.com\n  login justinlietz93\n  password %s\n" "$GH_PAT" > ~/.netrc
          chmod 600 ~/.netrc

      - name: Install private kernel
        run: pip install "vdm-kernel-private @ git+https://github.com/Neuroca-Inc/Private_VDM_Package.git@v0.1.2"

      - name: Set plugin environment variable
        run: echo "VDM_CLASSIFIED_PLUGIN=vdm_kernel_private" >> "$GITHUB_ENV"

      - name: Run proofs
        run: python scripts/run_proofs.py --seed 42 --out out/

      - name: Clean PAT credentials
        if: always()
        run: rm -f ~/.netrc
